---
import type { GetStaticPaths } from 'astro'
import PostPage from '../components/PostPage.astro'
import Pagination from '../components/control/Pagination.astro'
import { PAGE_SIZE } from '../constants/constants'
import MainGridLayout from '../layouts/MainGridLayout.astro'
import { getSortedPosts } from '../utils/content-utils'

const languages = ['en', 'de']

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const allBlogPosts = await getSortedPosts()

  const paths = []
  for (const lang of languages) {
    const paginated = paginate(allBlogPosts, { pageSize: PAGE_SIZE })
    for (const path of paginated) {
      paths.push({
        params: {
          page: path.params.page,
        },
        props: {
          lang,  // Pass language to each page
          ...path.props
        },
        route: `/${lang}/${path.route}` // Add language prefix to the route
      })
    }
  }
  return paths
}

const { page, lang } = Astro.props

const len = page.data.length
---

<MainGridLayout lang={lang}> <!-- Pass language prop down -->
    <PostPage page={page} lang={lang}></PostPage>
    <Pagination class="mx-auto onload-animation" page={page} style=`animation-delay: calc(var(--content-delay) + ${(len)*50}ms)`></Pagination>
</MainGridLayout>
